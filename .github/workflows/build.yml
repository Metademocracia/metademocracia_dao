name: Build and Push Docker Image

on:
  workflow_dispatch:
  push:
    branches:
      - main  # Change this to your default branch if it's not 'main'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Log in to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Create .env file
        run: |
          echo "VITE_ROUTER_WALLET=${{ secrets.VITE_ROUTER_WALLET }}" > .env
          echo "BASE_URL=${{ secrets.BASE_URL }}" >> .env
          echo "VITE_BASE_URL=${{ secrets.VITE_BASE_URL }}" >> .env
          echo "VITE_API_URL=${{ secrets.VITE_API_URL }}" >> .env
          echo "VITE_RECAPTCHA_SITE_KEY=${{ secrets.VITE_RECAPTCHA_SITE_KEY }}" >> .env
          echo "DOMAIN_WEB=${{ secrets.DOMAIN_WEB }}" >> .env
          echo "VITE_NETWORK=${{ secrets.VITE_NETWORK }}" >> .env
          echo "VITE_CONTRACT_DAO=${{ secrets.VITE_CONTRACT_DAO }}" >> .env
          echo "VITE_CONTRACT_USDT=${{ secrets.VITE_CONTRACT_USDT }}" >> .env
          echo "VITE_CONTRACT_FACTORY=${{ secrets.VITE_CONTRACT_FACTORY }}" >> .env
          echo "VITE_ROUTER_GRAPH_DAOS=${{ secrets.VITE_ROUTER_GRAPH_DAOS }}" >> .env
          echo "VITE_ROUTER_EXPLORER_NEAR_HASH=${{ secrets.VITE_ROUTER_EXPLORER_NEAR_HASH }}" >> .env
          echo "VITE_URL_APIP_PRICE=${{ secrets.VITE_URL_APIP_PRICE }}" >> .env
          echo "VITE_ROUTER_RPC=${{ secrets.VITE_ROUTER_RPC }}" >> .env
          echo "VITE_ROUTER_GRAPH=${{ secrets.VITE_ROUTER_GRAPH }}" >> .env
          echo "NODE_ENV=${{ secrets.NODE_ENV }}" >> .env
          echo "VITE_KEY_IPFS=${{ secrets.VITE_KEY_IPFS }}" >> .env
          echo "VITE_ROUTER_API_METADEMOCRACIA=${{ secrets.VITE_ROUTER_API_METADEMOCRACIA }}" >> .env
          echo "VITE_CONTRACT_ARP=${{ secrets.VITE_CONTRACT_ARP }}" >> .env
          echo "VITE_CONTRACT_WBTC=${{ secrets.VITE_CONTRACT_WBTC }}" >> .env
          echo "VUE_API_KEY_PIKESPEAK=${{ secrets.VUE_API_KEY_PIKESPEAK }}" >> .env
          echo "VITE_ROUTER_API_UPLOAD_IMG=${{ secrets.VITE_ROUTER_API_UPLOAD_IMG }}" >> .env

      - name: Build and push Docker image
        uses: docker/build-push-action@v2
        with:
          context: .
          push: true
          tags: ${{ secrets.DOCKER_USERNAME }}/dao-metademocracia-front:latest